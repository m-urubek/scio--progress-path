@using ProgressPath.Models

@* ProgressIndicator.razor - Displays progress for both binary and percentage goals.
   REQ-GOAL-007: Student sees current progress indicator as a progress bar with percentage.
   REQ-GOAL-012: Percentages rounded to whole integers.
   REQ-GOAL-001: Binary goals displayed as checkmark, percentage goals as progress bar. *@

@if (GoalType == GoalType.Binary)
{
    @* Binary Goal: Circle indicator with checkmark when complete *@
    @if (IsCompleted)
    {
        <div class="flex items-center gap-2">
            <div class="flex items-center justify-center w-8 h-8 rounded-full"
                 style="background: linear-gradient(to right, var(--color-tertiary), var(--color-secondary));">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
            </div>
            <span class="text-sm font-medium" style="color: var(--color-tertiary);">Complete!</span>
        </div>
    }
    else
    {
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full border-2 opacity-50"
                 style="border-color: var(--color-secondary);"></div>
            <span class="text-sm opacity-75">In Progress</span>
        </div>
    }
}
else
{
    @* Percentage Goal: Progress bar with percentage display *@
    var percentage = CalculatePercentage();
    <div class="flex items-center gap-3">
        <div class="w-24 h-2 rounded-full" style="background: rgba(192, 132, 252, 0.2);">
            <div class="h-full rounded-full transition-all duration-300"
                 style="width: @(percentage)%; background: linear-gradient(to right, var(--color-primary), var(--color-secondary));">
            </div>
        </div>
        <span class="text-sm font-medium" style="min-width: 40px; color: @(percentage == 100 ? "var(--color-tertiary)" : "inherit");">
            @(percentage)%
        </span>
    </div>
}

@code {
    /// <summary>
    /// The type of goal (Binary or Percentage).
    /// </summary>
    [Parameter]
    public GoalType GoalType { get; set; }

    /// <summary>
    /// Current progress value. For percentage goals, this is already a percentage (0-100).
    /// For binary goals, 0 = incomplete, 1 = complete.
    /// </summary>
    [Parameter]
    public int CurrentProgress { get; set; }

    /// <summary>
    /// Total steps for percentage goals (informational context).
    /// Null or 1 for binary goals.
    /// </summary>
    [Parameter]
    public int? TotalSteps { get; set; }

    /// <summary>
    /// Whether the goal is completed.
    /// </summary>
    [Parameter]
    public bool IsCompleted { get; set; }

    /// <summary>
    /// Calculates the progress percentage for display (REQ-GOAL-012).
    /// For percentage goals, CurrentProgress already stores the percentage directly.
    /// </summary>
    private int CalculatePercentage()
    {
        if (GoalType == GoalType.Binary)
        {
            return IsCompleted ? 100 : 0;
        }

        // CurrentProgress is already a percentage (0-100) for percentage goals
        return Math.Clamp(CurrentProgress, 0, 100);
    }
}
